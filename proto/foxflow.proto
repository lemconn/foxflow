syntax = "proto3";

package generated;

option go_package = "github.com/lemconn/foxflow/proto/generated";

// 简化的 FoxFlow gRPC 服务定义
service FoxFlowService {
  // 认证
  rpc Authenticate(AuthRequest) returns (AuthResponse);
  
  // Token 刷新
  rpc RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse);
  
  // 命令传递
  rpc SendCommand(CommandRequest) returns (CommandResponse);
  
  // 新闻查询
  rpc GetNews(GetNewsRequest) returns (GetNewsResponse);
  
  // 交易所查询
  rpc GetExchanges(GetExchangesRequest) returns (GetExchangesResponse);

  // 激活交易所
  rpc UseExchange(UseExchangeRequest) returns (UseExchangeResponse);

  // 激活账户
  rpc UseAccount(UseAccountRequest) returns (UseAccountResponse);
  
  // 账户查询
  rpc GetAccounts(GetAccountsRequest) returns (GetAccountsResponse);

  // 资产查询
  rpc GetBalance(GetBalanceRequest) returns (GetBalanceResponse);

  // 仓位查询
  rpc GetPositions(GetPositionsRequest) returns (GetPositionsResponse);

  // 交易对查询
  rpc GetSymbols(GetSymbolsRequest) returns (GetSymbolsResponse);
  
  // 订单查询
  rpc GetOrders(GetOrdersRequest) returns (GetOrdersResponse);

  // 更新账户杠杆配置
  rpc UpdateTradeConfig(UpdateTradeConfigRequest) returns (UpdateTradeConfigResponse);

  // 更新账户代理设置
  rpc UpdateProxyConfig(UpdateProxyConfigRequest) returns (UpdateProxyConfigResponse);

  // 更新标的杠杆配置
  rpc UpdateSymbol(UpdateSymbolRequest) returns (UpdateSymbolResponse);

  // 更新账户信息
  rpc UpdateAccount(UpdateAccountRequest) returns (UpdateAccountResponse);
}

// 认证请求
message AuthRequest {
  string username = 1;
  string password = 2;
}

// 认证响应
message AuthResponse {
  bool success = 1;
  string message = 2;
  string access_token = 3;    // JWT access token
  int64 expires_at = 4;       // Token 过期时间 (Unix 时间戳)
}

// 命令请求
message CommandRequest {
  string command = 1;
  repeated string args = 2;
  string exchange = 3;
  string account = 4;
  string access_token = 5;    // JWT access token
}

// 命令响应
message CommandResponse {
  bool success = 1;
  string message = 2;
}

// 新闻查询请求
message GetNewsRequest {
  int32 count = 1;        // 获取新闻数量
  string source = 2;      // 新闻源名称（可选）
  string access_token = 3; // JWT access token
}

// 新闻项
message NewsItem {
  string id = 1;                    // 新闻唯一标识
  string title = 2;                 // 新闻标题
  string content = 3;               // 新闻内容
  string url = 4;                   // 新闻链接
  string source = 5;                // 新闻源名称
  int64 published_at = 6;           // 发布时间（Unix时间戳）
  repeated string tags = 7;         // 标签列表
  string image_url = 8;             // 图片链接
}

// 新闻查询响应
message GetNewsResponse {
  bool success = 1;
  string message = 2;
  repeated NewsItem news = 3;       // 新闻列表
}

// 交易所查询请求
message GetExchangesRequest {
  string access_token = 1; // JWT access token
}

// 交易所信息
message ExchangesItem {
  string name = 1;
  string api_url = 2;
  string proxy_url = 3;
  int64 status_value = 4;
}

// 交易所查询响应
message GetExchangesResponse {
  bool success = 1;
  string message = 2;
  repeated ExchangesItem exchanges = 3; // 交易所列表
}

// 激活交易所请求
message UseExchangeRequest {
  string access_token = 1; // JWT access token
  string exchange = 2;     // 要激活的交易所名称
}

// 激活交易所响应
message UseExchangeResponse {
  bool success = 1;
  string message = 2;
  ExchangesItem exchange = 3;
}

// 激活账户请求
message UseAccountRequest {
  string access_token = 1; // JWT access token
  string account = 2;      // 要激活的账户名称
}

// 激活账户响应
message UseAccountResponse {
  bool success = 1;
  string message = 2;
  AccountsItem account = 3;
  ExchangesItem exchange = 4;
}

// 资产查询请求
message GetBalanceRequest {
  string access_token = 1; // JWT access token
  int64 account_id = 2;    // 账户ID
}

// 资产信息
message BalanceItem {
  string currency = 1;
  string balance = 2;
  string available = 3;
  string frozen = 4;
}

// 资产查询响应
message GetBalanceResponse {
  bool success = 1;
  string message = 2;
  repeated BalanceItem assets = 3; // 资产列表
}

// 仓位查询请求
message GetPositionsRequest {
  string access_token = 1; // JWT access token
  int64 account_id = 2;    // 账户ID
}

// 仓位信息
message PositionItem {
  string symbol = 1;
  string pos_side = 2;
  string margin_type = 3;
  string size = 4;
  string avg_price = 5;
  string unreal_pnl = 6;
}

// 仓位查询响应
message GetPositionsResponse {
  bool success = 1;
  string message = 2;
  repeated PositionItem positions = 3; // 仓位列表
}

// 交易对查询请求
message GetSymbolsRequest {
  string access_token = 1; // JWT access token
  string exchange = 2;     // 交易所名称
  string keyword = 3;      // 关键字过滤（可选）
}

// 交易对信息
message SymbolItem {
  string exchange = 1;
  string type = 2;
  string name = 3;
  string price = 4;
  string volume = 5;
  string high = 6;
  string low = 7;
  string base = 8;
  string quote = 9;
  int64 max_leverage = 10;
  string min_size = 11;
  string contract = 12;
}

// 交易对查询响应
message GetSymbolsResponse {
  bool success = 1;
  string message = 2;
  repeated SymbolItem symbols = 3; // 交易对列表
}

// 更新标的配置请求
message UpdateSymbolRequest {
  string access_token = 1;
  int64 account_id = 2;
  string exchange = 3;
  string symbol = 4;
  string margin = 5;
  int64 leverage = 6;
}

// 更新标的配置响应
message UpdateSymbolResponse {
  bool success = 1;
  string message = 2;
}

// 更新账户杠杆配置请求
message UpdateTradeConfigRequest {
  string access_token = 1;
  int64 account_id = 2;
  string margin = 3;
  int64 leverage = 4;
}

// 更新账户杠杆配置响应
message UpdateTradeConfigResponse {
  bool success = 1;
  string message = 2;
  AccountsItem account = 3;
}

// 更新账户代理设置请求
message UpdateProxyConfigRequest {
  string access_token = 1;
  int64 account_id = 2;
  string proxy_url = 3;
}

// 更新账户代理设置响应
message UpdateProxyConfigResponse {
  bool success = 1;
  string message = 2;
  AccountsItem account = 3;
}

// 更新账户信息请求
message UpdateAccountRequest {
  string access_token = 1;
  string exchange = 2;
  string target_account = 3;
  string trade_type = 4;
  string name = 5;
  string api_key = 6;
  string secret_key = 7;
  string passphrase = 8;
}

// 更新账户信息响应
message UpdateAccountResponse {
  bool success = 1;
  string message = 2;
  AccountsItem account = 3;
}

// Token 刷新请求
message RefreshTokenRequest {
  string access_token = 1;          // 当前的 access token
}

// Token 刷新响应
message RefreshTokenResponse {
  bool success = 1;
  string message = 2;
  string access_token = 3;          // 新的 JWT access token
  int64 expires_at = 4;             // 新的过期时间 (Unix 时间戳)
}

// 账户查询请求
message GetAccountsRequest {
  string access_token = 1; // JWT access token
}

// 账户信息
message AccountsItem {
  int64 id = 1;
  string name = 2;
  string exchange = 3;
  string trade_type_value = 4;
  int64 status_value = 5;
  int64 isolated_leverage = 6;
  int64 cross_leverage = 7;
  string proxy_url = 8;
}

// 账户信息查询响应
message GetAccountsResponse {
  bool success = 1;
  string message = 2;
  repeated AccountsItem accounts = 3;       // 账户列表
}

// 订单查询请求
message GetOrdersRequest {
  string access_token = 1;     // JWT access token（必填）
  int64 account_id = 2;        // 账户ID（必填，必须大于0）
  repeated string status = 3;  // 订单状态过滤（可选）
}

// 订单信息
message OrderItem {
  int64 id = 1;                // 订单ID
  string exchange = 2;         // 交易所
  int64 account_id = 3;        // 账户ID
  string symbol = 4;           // 交易对符号
  string side = 5;             // 买卖方向 (buy/sell)
  string pos_side = 6;         // 持仓方向 (long/short)
  string margin_type = 7;      // 保证金类型 (isolated/cross)
  string price = 8;            // 价格
  string size = 9;             // 数量
  string size_type = 10;       // 数量类型
  string order_type = 11;      // 订单类型 (limit/market)
  string strategy = 12;        // 策略名称
  string order_id = 13;        // 交易所订单ID
  string type = 14;            // 订单类型 (open/close)
  string status = 15;          // 订单状态 (waiting/opened/closed/failed/cancelled)
  string msg = 16;             // 订单消息/描述
  int64 created_at = 17;       // 创建时间（Unix时间戳）
  int64 updated_at = 18;       // 更新时间（Unix时间戳）
}

// 订单查询响应
message GetOrdersResponse {
  bool success = 1;
  string message = 2;
  repeated OrderItem orders = 3;  // 订单列表
}